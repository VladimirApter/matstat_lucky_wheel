import pandas as pd
from flask import Flask, render_template, abort, jsonify
import threading
import random
from livereload import Server

app = Flask(__name__, static_folder='static', static_url_path='/static')
app.secret_key = 'your_secret_key_here'

GROUPS = {
    'ft-201-1': '0',
    'ft-201-2': '313135890',
    'ft-202-1': '429115037',
    'ft-202-2': '1499384932',
    'ft-203-1': '1434241927',
    'ft-203-2': '101485156',
    'ft-204-1': '1801994266',
    'ft-204-2': '2063966210',
    'kn': '393945752'
}

GROUPS_COUNT ={
    '0': 14,
    '313135890' : 14,
    '429115037' : 15,
    '1499384932' : 15,
    '1434241927' : 13,
    '101485156' : 13,
    '1801994266': 13,
    '2063966210': 14,
    '393945752': 4,
}

class StudentSelector:
    EXCLUDED_STUDENTS = {
        "–ë—É—Ç–æ–≤–æ–π –í–ª–∞–¥–∏—Å–ª–∞–≤",
        "–ì–∞–ª—å—è–Ω–æ–≤ –§—ë–¥–æ—Ä",
        "–ë–∞—Ä—Ö–∞—Ç–æ–≤–∞ –ê–ª—ë–Ω–∞",
        "–ü—É–∑—ã–Ω–∏–Ω –ì–µ–æ—Ä–≥–∏–π",
        "–°–∏–¥–æ—Ä–æ–≤–∞ –ê–ª—ë–Ω–∞",
        "–û–¥–∞–π–∫–∏–Ω–∞ –ï–ª–∏–∑–∞–≤–µ—Ç–∞",
        "–Æ–¥–∏–Ω –ù–∏–∫–æ–ª–∞–π",
        "–ê—Ä—Ç–µ–º—å–µ–≤ –¢–∏–º–æ—Ñ–µ–π",
        "–ö–æ–ª–µ—Å–Ω–∏–∫–æ–≤ –ó–∞—Ö–∞—Ä",
        "–ü–µ—á–Ω–∏–∫–æ–≤ –ì–µ–æ—Ä–≥–∏–π",
        "–°–∞—Ö–±–∏–µ–≤ –ú–∞—Ä–∞—Ç",
        "–°—É—Å—Ç–∞–≤–æ–≤ –î–∞–Ω–∏–ª –°–µ—Ä–≥–µ–µ–≤–∏—á"
    }

    @staticmethod
    def get_student_data(gid):
        url = f"https://docs.google.com/spreadsheets/d/1QyIvnpMN1H3v6Ywj6QGl59KsdRbeUrtHXcAlE45sasY/export?format=csv&gid={gid}"
        df = pd.read_csv(url)

        practice_columns = [9, 11, 13, 15, 17, 20, 24, 26, 29, 31, 33, 35]

        students = []
        for row_idx in range(GROUPS_COUNT[gid]):
            try:
                row = df.iloc[row_idx]
                name = row.iloc[0]

                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
                if name in StudentSelector.EXCLUDED_STUDENTS:
                    continue

                total = sum(
                    float(str(val).replace(',', '.')) if str(val).replace(',', '').replace('.', '').isdigit() else 0.0
                    for val in row.iloc[practice_columns]
                )

                students.append({
                    'name': name,
                    'score': round(total, 2)
                })

            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ {row_idx}: {e}")

        return students


@app.route('/<group_name>')
def wheel_of_fortune(group_name):
    if group_name not in GROUPS:
        abort(404)

    gid = GROUPS[group_name]
    students = StudentSelector.get_student_data(gid)

    if students is None:
        return "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç—É–¥–µ–Ω—Ç–∞—Ö", 500

    formatted_students = [{
        "name": s['name'],
        "score": s['score']
    } for s in students]

    return render_template('wheel.html', students=formatted_students)


@app.route('/')
def main_page():
    return render_template('main.html')

MESSAGES = [
    """
    <h3>üß† –ë–µ—Å–µ–¥–∞ –º–µ–≥–∞–º–æ–∑–≥–æ–≤</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ì–¥–µ –º–æ–π –ª—é–±–∏–º—ã–π –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π –º–∞—Ä–∫–µ—Ä?</div>
        <div><strong>#–ú–∏–∑—É—Ä–æ–≤–∞:</strong> –î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –ê–Ω–¥—Ä–µ–π –Ω–∞ –ø–µ—Ä–≤–æ–π –ø–∞—Ä–µ –≤–∑—è–ª –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π –º–∞—Ä–∫–µ—Ä –∏ —Å—Ç–∞–ª —Å–º–µ—è—Ç—å—Å—è</div>
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ù—É –∞ —á—Ç–æ, —è –µ—â–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–µ–ª –∫–æ—Ä–∏—á–Ω–µ–≤—ã—Ö</div>
        <div><strong>#–ú–∏–∑—É—Ä–æ–≤–∞:</strong> –ê –º–∞—Ä–∫–µ—Ä—ã?</div>
    </div>
    """,

    """
    <h3>üìö –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è</h3>
    <div class="chat-log">
        <div><strong>–°:</strong> –ê —á—Ç–æ –∑–Ω–∞—á–∏—Ç –≤–æ—Ç —ç—Ç–∞ –≤–æ—Ç –∑–∞–ø–∏—Å—å –≤ —Å–∫–æ–±–æ—á–∫–∞—Ö –≤ —Ç–µ–æ—Ä–∏–∏?</div>
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –¢–∞–∫, —ç—Ç–æ —è –ø–∏—Å–∞–ª. –ê –∑–∞—á–µ–º —è —ç—Ç–æ –Ω–∞–ø–∏—Å–∞–ª?</div>
    </div>
    """,

    """
    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ-—Ö–æ–≤—Ä—ã—á–µ–≤—Å–∫–∏</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –≠—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–æ—Ç —Ç–∞–∫</div>
        <div><strong>–°:</strong> –ê –ø–æ—á–µ–º—É —Ç–∞–∫?</div>
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –≠—Ç–æ —Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å. –ú–æ–∂–µ—Ç–µ –¥–æ–º–∞ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –∏ –º–Ω–µ –ø–æ—Ç–æ–º –æ–±—ä—è—Å–Ω–∏—Ç—å</div>
    </div>
    """,

    """
    <h3>ü§ñ –°–æ–≤–µ—Ç—ã –±—É–¥—É—â–µ–≥–æ</h3>
    <div class="chat-log">
        <div>–ú–æ–≥–ª–∏ –±—ã —É–∂–µ –¥–∞–≤–Ω–æ –≤ ChatGPT –∑–∞–±–∏—Ç—å. –°–∏–¥—è—Ç —Ç—É—Ç —á—Ç–æ-—Ç–æ, –¥—É–º–∞—é—Ç</div>
    </div>
    """,

    """
    <h3>üß† –°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∫–∞</h3>
    <div class="chat-log">
        <div>–≠—Ç–æ –∑–∞–¥–∞—á–∫–∞ —Å–ª–æ–∂–Ω–∞—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –µ–µ –µ—â–µ —Ä–∞–∑ –¥–æ–º–∞...</div>
        <div><em>*–ù–∞—á–∏–Ω–∞–µ—Ç —Å–º–µ—è—Ç—å—Å—è*</em></div>
    </div>
    """,

    """
    <h3>üß† –ü–∞–º—è—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
    <div class="chat-log">
        <div>–ö–ª–∞—Å—Å–Ω–æ, —á—Ç–æ —Ç—ã —ç—Ç–æ –ø–æ–º–Ω–∏—à—å. –•–æ—Ç—è –≤–æ–æ–±—â–µ-—Ç–æ –≤—Å–µ –¥–æ–ª–∂–Ω—ã —ç—Ç–æ –ø–æ–º–Ω–∏—Ç—å</div>
    </div>
    """,

    """
    <h3>üåô –ù–æ—á—å, —Å–ø–∏–Ω–Ω–µ—Ä –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h3>
    <div class="chat-log">
        <div><strong>–ê:</strong> –Ø –Ω–µ —Å–ø–∞–ª –≤—Å—é –Ω–æ—á—å –∏ —á–∏—Ç–∞–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π. –í—ã –∑–Ω–∞–ª–∏, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –≥–æ–º–µ–æ–º–æ—Ä—Ñ–µ–Ω —Å–ø–∏–Ω–Ω–µ—Ä—É?</div>
    </div>
    """,

    """
    <h3>üßë‚Äçüè´ –°–∞–º —Å–µ–±–µ –æ–±—ä—è—Å–Ω–∏–ª</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ù–µ –Ω—É —è —Å—á–∏—Ç–∞—é —á—Ç–æ —è –¥–ª—è —Å–µ–±—è –ø—Ä—è–º–æ —Ö–æ—Ä–æ—à–æ –æ–±—ä—è—Å–Ω–∏–ª</div>
        <div><strong>–°:</strong> –ù—É –≥–ª–∞–≤–Ω–æ–µ —á—Ç–æ —Ç—ã –ø–æ–Ω—è–ª</div>
    </div>
    """,

    """
    <h3>üìâ –ê–Ω–∞–ª–∏–∑ —Å —é–º–æ—Ä–æ–º</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –¢–∞–∫, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–∞–∑–¥–µ–ª—É "–û–¥–Ω–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–π –¥–∏—Å–ø–µ—Ä—Å–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑"</div>
        <div><strong>–°:</strong> –ù—É –Ω–µ–µ—Ç</div>
        <div><strong>#–ú–∏–∑—É—Ä–æ–≤–∞:</strong> –Ø —Ç–µ–±–µ –≥–æ–≤–æ—Ä—é, –æ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è "–î–µ–ø—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π"</div>
    </div>
    """,

    """
    <h3>ü§î –§–∏–ª–æ—Å–æ—Ñ–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
    <div class="chat-log">
        <div>- –ó–∞–¥–∞–π—Ç–µ —É–∂–µ –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–¥–æ –∑–∞–¥–∞—Ç—å</div>
        <div>- –õ–∞–¥–Ω–æ, —è —Å–∞–º –≤–∞—Å –ø–æ–¥–≤–µ–¥—É –∫ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É</div>
        <div>- –•–æ—Ç—è –Ω–µ—Ç, —ç—Ç–æ —É–∂–µ –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è</div>
        <div>- –ù—É –ª–∞–¥–Ω–æ, —Ä–∞–∑ –æ–Ω —É –≤–∞—Å –Ω–µ –≤–æ–∑–Ω–∏–∫, –º–æ–∂–µ—Ç –∏ –Ω–µ –Ω–∞–¥–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å?</div>
        <div>- –ò–ª–∏ —ç—Ç–æ —è —á–µ—Ä–µ—Å—á—É—Ä —Ö–æ—Ä–æ—à–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª—Å—è –∫ –ø–∞—Ä–µ?</div>
    </div>
    """,

    """
    <h3>ü§Ø –ó–∞ –≥—Ä–∞–Ω—å—é –ø–æ–Ω–∏–º–∞–Ω–∏—è</h3>
    <div class="chat-log">
        <div>–ß–µ–ª–æ–≤–µ–∫ –≤ –∑–¥—Ä–∞–≤–æ–º —É–º–µ —Ç–∞–∫–æ–≥–æ –Ω–µ –ø—Ä–∏–¥—É–º–∞–µ—Ç –∏ –Ω–µ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç</div>
    </div>
    """,

    """
    <h3>üîÑ –í–æ–ø—Ä–æ—Å—ã –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ü–æ—á–µ–º—É –≤—ã –Ω–µ –∑–∞–¥–∞–µ—Ç–µ –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞–ª–∏ –Ω–∞ –ø—Ä–æ—à–ª–æ–π –ø–∞—Ä–µ</div>
        <div><strong>–°:</strong> –ê –≤ —á–µ–º —Å–º—ã—Å–ª?</div>
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ù–µ–µ—Ç, –Ω–µ —Ç–∞–∫–æ–π</div>
    </div>
    """,

    """
    <h3>üé≠ –í—ã–¥—É–º–∞–Ω–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—ã —É–±–µ–¥–∏–ª–∏—Å—å, —á—Ç–æ –º—ã —ç—Ç–æ –≤—Å–µ –Ω–µ –º—ã –≤—ã–¥—É–º–∞–ª–∏</div>
        <div><strong>#–ú–∏–∑—É—Ä–æ–≤–∞:</strong> –ê –ø—Ä–∏–∫–∏–Ω—å –º—ã –≤–æ–æ–±—â–µ –≤—Å–µ —ç—Ç–æ –≤—ã–¥—É–º–∞–ª–∏ –∏ —Å–µ–π—á–∞—Å –≤–∞–º —Ç—É—Ç —ç—Ç–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ–º</div>
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ù—É—É, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —è –Ω–µ –≤—Å–µ —á—Ç–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª –±—Ä–∞–ª –∏–∑ —É—á–µ–±–Ω–∏–∫–æ–≤</div>
    </div>
    """,

    """
    <h3>‚ö∞Ô∏è –ó–∞–¥–∞—á–∏-–≥—Ä–æ–±—ã</h3>
    <div class="chat-log">
        <div>–û–π —á—Ç–æ —Ç–æ —è –º–Ω–æ–≥–æ –≥—Ä–æ–±–æ–≤ –¥–æ–±–∞–≤–∏–ª. –ù–∞–¥–µ—é—Å—å –Ω–∏–∫—Ç–æ –Ω–µ –±—É–¥–µ—Ç –∏—Ö —Ä–µ—à–∞—Ç—å, –∞ —Ç–æ –Ω–∞–≤–µ—Ä–Ω–æ–µ –º–Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –∏—Ö –ø—Ä–æ–≤–µ—Ä—è—Ç—å...</div>
    </div>
    """,

    """
    <h3>‚úèÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫</h3>
    <div class="chat-log">
        <div>–ú—ã –¥–æ–ª–∂–Ω—ã –¥–æ—Ä–µ—à–∞—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É, –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã —Å –ø—Ä–æ—à–ª–æ–π –≥—Ä—É–ø–ø–æ–π –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ—à–∏–ª–∏, –∞ —è —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ—Ç–≤–µ—Ç</div>
    </div>
    """,

    """
    <h3>üë®üè´ –ù–∞—Å–ª–µ–¥–∏–µ –ö–æ–ª–º–æ–≥–æ—Ä–æ–≤–∞</h3>
    <div class="chat-log">
        <div>–†–µ—à–∞—Ç—å –∑–∞–¥–∞—á—É –±—É–¥–µ—Ç –ö–æ–ª–º–æ–≥–æ—Ä–æ–≤, –∞ –Ω–µ –º—ã</div>
    </div>
    """,

"""
    <h3>üëÆ‚ôÇÔ∏è –í–æ–µ–Ω–∫–æ–º–∞—Ç vs –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
    <div class="chat-log">
        <div><strong>#–•–æ–≤—Ä—ã—á–µ–≤:</strong> –ú—ã –∂–µ –Ω–µ –º–æ–∂–µ–º –ø–æ–π–º–∞—Ç—å –≤—Å–µ—Ö –º—É–∂—á–∏–Ω –Ω–∞ —É–ª–∏—Ü–µ –∏ –∏–∑–º–µ—Ä–∏—Ç—å</div>
        <div><strong>#–ú–∏–∑—É—Ä–æ–≤–∞:</strong> –ù–µ —Å–æ–≥–ª–∞—Å–Ω–∞, –≤–æ–µ–Ω–∫–æ–º–∞—Ç –º–æ–∂–µ—Ç</div>
    </div>
    """,

    """
    <h3>üï∫ –ß–µ—Ç–≤–µ—Ä–æ –º—É–∂–∏–∫–æ–≤ –∏ –º–æ–ª–æ—Ç–æ–∫</h3>
    <div class="chat-log">
        <div>–ë—É–¥–µ—Ç —É –Ω–∞—Å 4 –º—É–∂–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã –±—É–¥–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</div>
    </div>
    """,

    """
    <h3>üî¢ –¢—Ä–∏ —Å–ª–æ–≤–∞ –∏–ª–∏ —Å–º–µ—Ä—Ç—å</h3>
    <div class="chat-log">
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –û—Ç–≤–µ—Ç—å—Ç–µ 3 —Å–ª–æ–≤–∞–º–∏, —á—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏–ª—å—Ç—Ä –ö–∞–ª–º–∞–Ω–∞. –Ø —Å—á–∏—Ç–∞—Ç—å –±—É–¥—É</div>
        <div><strong>–°:</strong> –ù—É –º–æ–≥—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å...</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –í—Å–µ, 3 —Å–ª–æ–≤–∞ —Å–∫–∞–∑–∞–Ω–æ</div>
    </div>
    """,

    """
    <h3>üò≠ –£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π –∫—É—Ä—Å –¥–µ–ø—Ä–µ—Å—Å–∏–∏</h3>
    <div class="chat-log">
        <div>–Ø —Ä–∞–Ω—å—à–µ –≤–æ—Ç —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –∑–∞ –º–µ—Å—è—Ü —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª. —Ç–∞–∫ —á—Ç–æ –µ—Å–ª–∏ –≤–∞–º –≥—Ä—É—Å—Ç–Ω–æ, —Ç–æ —ç—Ç–æ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ</div>
    </div>
    """,

    """
    <h3>ü•æ –ö—Ä–∞—Å–æ—Ç–∞ —á–µ—Ä–µ–∑ –ø–∏–Ω–∫–∏</h3>
    <div class="chat-log">
        <div>–Ø —Ö–æ—á—É —á—Ç–æ–±—ã –º–∏—Ä –±—ã–ª –∫—Ä–∞—Å–∏–≤—ã–π. –ê –µ—Å–ª–∏ –æ–Ω –≤–¥—Ä—É–≥ –Ω–µ –∫—Ä–∞—Å–∏–≤—ã–π, —Ç–æ –Ω–∞–¥–æ –∑–∞–ø–∏–Ω–∞—Ç—å –µ–≥–æ –Ω–æ–≥–∞–º–∏ –≤ –∫—Ä–∞—Å–∏–≤—ã–π —è—â–∏–∫</div>
    </div>
    """,

    """
    <h3>ü¶∂ –û—Ü–µ–Ω–∫–∞ –ø–æ –ø—è—Ç–∫–∞–º</h3>
    <div class="chat-log">
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –±–∞–ª–ª—ã –ø—É—Å—Ç—å –î–º–∏—Ç—Ä–∏–π –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç. –£ –º–µ–Ω—è –æ—Ü–µ–Ω–∫–∞ - –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ç 1 –¥–æ 10, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ª–µ–≤–æ–π –ø—è—Ç–∫–∏...</div>
        <div><strong>#–°–µ–Ω–Ω–∏–∫–æ–≤:</strong> —É–≤—ã, —É –º–µ–Ω—è —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞—è –ø—è—Ç–∫–∞ –Ω–∞–ø—Ä—è–∂–µ–Ω–∞.</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> —É–∂–∞—Å–Ω–æ.</div>
    </div>
    """,

    """
    <h3>üí° –ì–µ–Ω–∏–∞–ª—å–Ω–∞—è —Ç—É–ø–æ—Å—Ç—å</h3>
    <div class="chat-log">
        <div>–£—Ä–∞–≤–Ω–µ–Ω–∏–µ 3 –Ω–∞–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –µ—Å—Ç—å —Ç—É–ø–æ–π –∏–∑—è—â–Ω—ã–π –º–µ—Ç–æ–¥. –û–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —Ç—É–ø–æ–π –∏ –∏–∑—è—â–Ω—ã–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ç—É–ø–æ–π, —á—Ç–æ –∞–∂ –∏–∑—è—â–Ω—ã–π</div>
    </div>
    """,

    """
    <h3>üß† –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫–ª–µ—Ä–æ–∑</h3>
    <div class="chat-log">
        <div><strong>–°:</strong> –ê –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å K –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ?</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –ù—É –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–ø—Ä–µ—â–∞–ª</div>
        <div><strong>–°:</strong> –ê –ø–æ—á–µ–º—É –º—ã —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞–µ–º?</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –ó–∞–±—ã–ª, —Å–∫–ª–µ—Ä–æ–∑. –í—Å–µ, —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å</div>
    </div>
    """,

    """
    <h3>üéØ –û—Ü–µ–Ω–∫–∞ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ</h3>
    <div class="chat-log">
        <div><strong>C:</strong> –≠—Ç–æ –∂–µ –æ—Ü–µ–Ω–∫–∞, –∞ —á—Ç–æ –æ–Ω–∞ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç?</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –ù—É –¥–∏—Å–ø–µ—Ä—Å–∏—é</div>
        <div><strong>C:</strong> –ù–µ—Ç, –Ω—É –∫–∞–∫ –æ–Ω–∞ –µ–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç?</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –ù—É, –∫–∞–∫ –º–æ–∂–µ—Ç</div>
    </div>
    """,

    """
    <h3>ü§ê –°—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –ø–æ e-–±–∞–ª–ª—É</h3>
    <div class="chat-log">
        <div>–•–æ—Ç–µ–ª–∏ –¥–∞—Ç—å 2 –±–∞–ª–ª–∞, –Ω–æ —Ç–∞–º –ø–æ—è–≤–∏–ª–∏—Å—å 2 —Å–ª–∞–π–¥–∞ –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –∏ –º—ã —Ä–µ—à–∏–ª–∏ —á—Ç–æ –∑–∞ —Ç–∞–∫–æ–µ –Ω–∞–¥–æ –¥–∞—Ç—å –ø–æ e-–±–∞–ª–ª—É, —Ç–∞–∫ —á—Ç–æ –≤–æ—Ç –≤–∞–º e-–±–∞–ª–ª –Ω–∞ –¥–≤–æ–∏—Ö</div>
    </div>
    """,

    """
    <h3>üèÜ –ù–µ–æ—Ç–ª–∏—á–Ω—ã–π –≤–æ—Å—Ç–æ—Ä–≥</h3>
    <div class="chat-log">
        <div><strong>#–°—Ç–∞—Ö–µ–µ–≤:</strong> –ü—Ä—è–º–æ —Ö–æ—Ä–æ—à–∏–π –¥–æ–∫–ª–∞–¥</div>
        <div><strong>#–•–ª–æ–ø–∏–Ω:</strong> –ù—É –¥–∞, —Å–æ–≥–ª–∞—Å–µ–Ω, —á—Ç–æ –Ω–µ –æ—Ç–ª–∏—á–Ω—ã–π</div>
    </div>
    """,
]


# –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–¥–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å
last_index = {'value': -1}
lock = threading.Lock()


@app.route("/next-message")
def next_message():
    with lock:
        available_indices = list(range(len(MESSAGES)))

        # –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–¥–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        if last_index['value'] in available_indices:
            available_indices.remove(last_index['value'])

        # –ï—Å–ª–∏ –≤—Å–µ —Ü–∏—Ç–∞—Ç—ã –±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã (–¥–ª—è —Å–ª—É—á–∞—è —Å 1 —Ü–∏—Ç–∞—Ç–æ–π), —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–≤—Ç–æ—Ä
        if not available_indices:
            available_indices = list(range(len(MESSAGES)))

        new_index = random.choice(available_indices)
        last_index['value'] = new_index

    return jsonify({"message": MESSAGES[new_index]})


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)